:py:mod:`exiftool`
==================

.. py:module:: exiftool


Submodules
----------
.. toctree::
   :titlesonly:
   :maxdepth: 1

   constants/index.rst
   exceptions/index.rst
   exiftool/index.rst
   experimental/index.rst
   helper/index.rst


Package Contents
----------------

Classes
~~~~~~~

.. autoapisummary::

   exiftool.ExifTool
   exiftool.ExifToolAlpha
   exiftool.ExifToolHelper




Attributes
~~~~~~~~~~

.. autoapisummary::

   exiftool.DEFAULT_EXECUTABLE
   exiftool.__version__


.. py:data:: DEFAULT_EXECUTABLE
   :annotation: = exiftool.exe

   

.. py:data:: __version__
   :annotation: = 0.5.1

   

.. py:class:: ExifTool(executable = None, common_args = ['-G', '-n'], win_shell = False, config_file = None, encoding = None, logger=None)

   Bases: :py:obj:`object`

   Run the `exiftool` command-line tool and communicate with it.

   Use ``common_args`` to enable/disable print conversion by specifying/omitting ``-n``, respectively.
   This determines whether exiftool should perform print conversion,
   which prints values in a human-readable way but
   may be slower. If print conversion is enabled, appending ``#`` to a tag
   name disables the print conversion for this particular tag.
   See `Exiftool print conversion FAQ`_ for more details.

   .. _Exiftool print conversion FAQ: https://exiftool.org/faq.html#Q6


   You can pass optional arguments to the constructor:

   * ``executable`` (string): file name of the *exiftool* executable.
     The default value :py:attr:`exiftool.constants.DEFAULT_EXECUTABLE` will only work if the executable
     is in your ``PATH``.
     You can also specify the full path to the ``exiftool`` executable.
     See :py:attr:`executable` property for more details.
   * ``common_args`` (list of strings): contains additional parameters for
     the stay-open instance of exiftool.  The default is ``-G`` and ``-n``.
     See :py:attr:`common_args` property for more details.
   * ``win_shell``

     .. note::
       This parameter may be deprecated in the future

   * ``config_file`` (string): file path to ``-config`` parameter when
     starting process.
     See :py:attr:`config_file` property for more details.
   * ``encoding`` (string): encoding to be used when communicating with
     exiftool process.  By default, will use ``locale.getpreferredencoding()``
     See :py:attr:`encoding` property for more details
   * ``logger`` (object):  Set a custom logger to log status and debug messages to.
     See :py:attr:`logger` for more details.

   Some methods of this class are only available after calling
   :py:meth:`run()`, which will actually launch the *exiftool* subprocess.  To
   avoid leaving the subprocess running, make sure to call
   :py:meth:`terminate()` method when finished using the instance.
   This method will also be implicitly called when the instance is
   garbage collected, but there are circumstance when this won't ever
   happen, so you should not rely on the implicit process
   termination.  Subprocesses won't be automatically terminated if
   the parent process exits, so a leaked subprocess will stay around
   until manually killed.

   A convenient way to make sure that the subprocess is terminated is
   to use the :py:class:`ExifTool` instance as a context manager::

           with ExifTool() as et:
                   ...

   .. warning::
           Note that options and parameters are not checked.  There is no error handling or validation of options passed to *exiftool*.
           Nonsensical options are mostly silently ignored by exiftool, so there's not
           much that can be done in that regard.  You should avoid passing
           non-existent files to any of the methods, since this will lead
           to undefined behaviour.


   .. py:attribute:: _running
      :annotation: :bool = False

      A Boolean value indicating whether this instance is currently
      associated with a running subprocess.


   .. py:attribute:: logger
      

      Write-only property to set the class of logging.Logger

      If this is set, then status messages will log out to the given class.

      :setter: Specify an object to log to.  The class is not checked, but validation is done to ensure the object has callable methods ``info``, ``warning``, ``error``, ``critical``, ``exception``.

      :raises AttributeError: If object does not contain one or more of the required methods.
      :raises TypeError: If object has one or more non-callable methods.

      :type: Object


   .. py:method:: __del__(self)


   .. py:method:: __enter__(self)


   .. py:method:: __exit__(self, exc_type, exc_val, exc_tb)


   .. py:method:: _flag_running_false(self)

      private method that resets the "running" state
      It used to be that there was only self._running to unset, but now it's a trio of variables

      This method makes it less likely a maintainer will leave off a variable if other ones are added in the future


   .. py:method:: _parse_ver(self)

      private method to run exiftool -ver
      and parse out the information


   .. py:method:: _set_logger(self, new_logger)

      set a new user-created logging.Logger object
      can be set at any time to start logging.

      Set to None at any time to stop logging


   .. py:method:: block_size(self)
      :property:

      Block size for communicating with *exiftool* subprocess.  Used when reading from the I/O pipe.

      :getter: Returns current block size

      :setter: Set a new block_size.  Does basic error checking to make sure > 0.

      :raises ValueError: If new block size is invalid

      :type: int


   .. py:method:: common_args(self)
      :property:

      Common Arguments executed with every command passed to *exiftool* subprocess

      This is the parameter `-common_args`_ that is passed when the *exiftool* process is STARTED

      Read `Phil Harvey's ExifTool documentation`_ to get further information on what options are available / how to use them.

      .. _-common_args: https://exiftool.org/exiftool_pod.html#Advanced-options
      .. _Phil Harvey's ExifTool documentation: https://exiftool.org/exiftool_pod.html

      :getter: Returns current common_args list

      :setter: If ``None`` is passed in, sets common_args to ``[]``.  Otherwise, sets the given list without any validation.

              .. warning::
                      No validation is done on the arguments list.  It is passed verbatim to *exiftool*.  Invalid options or combinations may result in undefined behavior.

              .. note::
                      Setting is only available when exiftool process is not running.

      :raises ExifToolRunning: If attempting to set while running (:py:attr:`running` == True)
      :raises TypeError: If setting is not a list

      :type: list[str], None


   .. py:method:: config_file(self)
      :property:

      Path to config file.

      See `ExifTool documentation for -config`_ for more details.



      :getter: Returns current config file path, or None if not set

      :setter: File existence is checked when setting parameter

              * Set to ``None`` to disable the ``-config`` parameter when starting *exiftool*
              * Set to ``""`` has special meaning and disables loading of the default config file.  See `ExifTool documentation for -config`_ for more info.

              .. note::
                      Currently file is checked for existence when setting.  It is not checked when starting process.

      :raises ExifToolRunning: If attempting to set while running (:py:attr:`running` == True)

      :type: str, Path, None

      .. _ExifTool documentation for -config: https://exiftool.org/exiftool_pod.html#Advanced-options


   .. py:method:: encoding(self)
      :property:

      Encoding of Popen() communication with *exiftool* process.

      :getter: Returns current encoding setting

      :setter: Set a new encoding.

              * If *new_encoding* is None, will detect it from ``locale.getpreferredencoding(do_setlocale=False)`` (do_setlocale is set to False as not to affect the caller).
              * Default to ``UTF-8`` if nothing is returned by ``getpreferredencoding``

              .. warning::
                      Property setter does NOT validate the encoding for validity.  It is passed verbatim into subprocess.Popen()

              .. note::
                      Setting is only available when exiftool process is not running.

      :raises ExifToolRunning: If attempting to set while running (:py:attr:`running` == True)



   .. py:method:: executable(self)
      :property:

      Path to *exiftool* executable.

      :getter: Returns current exiftool path
      :setter: Specify just the executable name, or an absolute path to the executable.
              If path given is not absolute, searches environment ``PATH``.

              .. note::
                      Setting is only available when exiftool process is not running.

      :raises ExifToolRunning: If attempting to set while running (:py:attr:`running` == True)
      :type: str, Path


   .. py:method:: execute(self, *params)

      Execute the given batch of parameters with *exiftool*.

      This method accepts any number of parameters and sends them to
      the attached ``exiftool`` subprocess.  The process must be
      running, otherwise ``ExifToolNotRunning`` is raised.  The final
      ``-execute`` necessary to actually run the batch is appended
      automatically; see the documentation of :py:meth:`run()` for
      the common options.  The ``exiftool`` output is read up to the
      end-of-output sentinel and returned as a ``str`` decoded
      based on the currently set :py:attr:`encoding`,
      excluding the sentinel.

      The parameters must be of type ``str``.  Use the :py:attr:`encoding` property to change the
      encoding ``exiftool`` accepts.  For filenames, this should be the
      system's filesystem encoding.

      .. note::
              This is the core method to interface with the ``exiftool`` subprocess.

              No processing is done on the input or output.

      :return:
              * STDOUT is returned by the method call, and is also set in :py:attr:`last_stdout`
              * STDERR is set in :py:attr:`last_stderr`
              * Exit Status of the command is set in :py:attr:`last_status`

      :raises ExifToolNotRunning: If attempting to execute when not running (:py:attr:`running` == False)
      :raises ExifToolVersionError: If unexpected text was returned from the command while parsing out the sentinels


   .. py:method:: execute_json(self, *params)

      Execute the given batch of parameters and parse the JSON output.

      This method is similar to :py:meth:`execute()`.  It
      automatically adds the parameter ``-j`` to request JSON output
      from ``exiftool`` and parses the output.

      The return value is
      a list of dictionaries, mapping tag names to the corresponding
      values.  All keys are strings.
      The values can have multiple types.  Each dictionary contains the
      name of the file it corresponds to in the key ``"SourceFile"``.

      .. note::
              By default, the tag names include the group name in the format <group>:<tag> (if using the ``-G`` option).

              You can adjust the output structure with various *exiftool* options.

      The parameters to this function must be type ``str``

      :return: valid JSON parsed into a Python list of dicts
      :raises OutputEmpty: If *exiftool* did not return any STDOUT

              .. note::
                      This is not necessarily an error, setting tags can cause this behavior.  Use :py:meth:`execute()` to set tags.

      :raises OutputNotJSON: If *exiftool* returned STDOUT which is invalid JSON.

              .. note::
                      This is not necessarily an error, ``-w`` can cause this behavior.  Use :py:meth:`execute()` if using the ``-w`` flag.


   .. py:method:: last_status(self)
      :property:

      ``Exit Status Code`` for most recent result from execute()

      .. note::
              This property can be read at any time, and is not dependent on running state of ExifTool.

              It is INTENTIONALLY *NOT* CLEARED on exiftool termination, to allow
              for executing a command and terminating, but still have result available.


   .. py:method:: last_stderr(self)
      :property:

      ``STDERR`` for most recent result from execute()

      .. note::
              This property can be read at any time, and is not dependent on running state of ExifTool.

              It is INTENTIONALLY *NOT* CLEARED on exiftool termination, to allow
              for executing a command and terminating, but still have result available.


   .. py:method:: last_stdout(self)
      :property:

      ``STDOUT`` for most recent result from execute()

      .. note::
              This property can be read at any time, and is not dependent on running state of ExifTool.

              It is INTENTIONALLY *NOT* CLEARED on exiftool termination, to allow
              for executing a command and terminating, but still have result available.


   .. py:method:: run(self)

      Start an *exiftool* subprocess in batch mode.

      This method will issue a ``UserWarning`` if the subprocess is
      already running (:py:attr:`running` == True).  The process is started with :py:attr:`common_args` as common arguments,
      which are automatically included in every command you run with :py:meth:`execute()`.

      You can override these default arguments with the
      ``common_args`` parameter in the constructor or setting :py:attr:`common_args` before caaling :py:meth:`run()`.

      .. note::
              If you have another executable named *exiftool* which isn't Phil Harvey's ExifTool, then you're shooting yourself in the foot as there's no error checking for that

      :raises FileNotFoundError: If *exiftool* is no longer found.  Re-raised from subprocess.Popen()
      :raises OSError: Re-raised from subprocess.Popen()
      :raises ValueError: Re-raised from subprocess.Popen()
      :raises subproccess.CalledProcessError: Re-raised from subprocess.Popen()
      :raises RuntimeError: Popen() launched process but it died right away
      :raises ExifToolVersionError: :py:attr:`exiftool.constants.EXIFTOOL_MINIMUM_VERSION` not met.  ExifTool process will be automatically terminated.


   .. py:method:: running(self)
      :property:

      Read-only property which indicates whether the *exiftool* subprocess is running or not.

      :getter: Returns current running state

              .. note::
                      This checks to make sure the process is still alive.

                      If the process has died since last `running` detection, this property
                      will detect the state change and reset the status accordingly.


   .. py:method:: terminate(self, timeout = 30, _del = False)

      Terminate the *exiftool* subprocess.

      If the subprocess isn't running, this method will throw a warning, and do nothing.

      .. note::
              There is a bug in CPython 3.8+ on Windows where terminate() does not work during __del__()
              See CPython issue `starting a thread in __del__ hangs at interpreter shutdown`_ for more info.

      .. _starting a thread in __del__ hangs at interpreter shutdown: https://bugs.python.org/issue43784


   .. py:method:: version(self)
      :property:

      Read-only property which is the string returned by ``exiftool -ver``

      The *-ver* command is ran once at process startup and cached.

      :getter: Returns cached output of ``exiftool -ver``

      :raises ExifToolNotRunning: If attempting to read while not running (:py:attr:`running` == False)



.. py:class:: ExifToolAlpha(auto_start=True, **kwargs)

   Bases: :py:obj:`exiftool.helper.ExifToolHelper`

   this class extends the ExifToolHelper class with alpha-quality code, which,
   may add functionality, but may introduce bugs or add in unneeded bloat which may
   be specific to niche use cases

   lots of these methods are from the original incarnation of pyexiftool
   with miscellaneous added pull requests.

   There's a lot of extra functionality, but the code quality leaves a lot to be desired

   And in some cases, there are edge cases which return unexpected results... so
   they will be placed into this class until the functionality can be standardized in a "stable" way


   Please issue PR to this class to add functionality, even if not tested well.  This class is for experimental code after all!

   .. py:method:: _check_sanity_of_result(file_paths, result)
      :staticmethod:

      Checks if the given file paths matches the 'SourceFile' entries in the result returned by
      exiftool. This is done to find possible mix ups in the streamed responses.


   .. py:method:: copy_tags(self, from_filename, to_filename)

      Copy all tags from one file to another.


   .. py:method:: execute_json_wrapper(self, filenames, params=None, retry_on_error=True)


   .. py:method:: get_metadata_batch_wrapper(self, filenames, params=None)


   .. py:method:: get_metadata_wrapper(self, filename, params=None)


   .. py:method:: get_tag(self, filename, tag)

      Extract a single tag from a single file.

      The return value is the value of the specified tag, or
      ``None`` if this tag was not found in the file.


   .. py:method:: get_tag_batch(self, filenames, tag)

      Extract a single tag from the given files.

      The first argument is a single tag name, as usual in the
      format <group>:<tag>.

      The second argument is an iterable of file names.

      The return value is a list of tag values or ``None`` for
      non-existent tags, in the same order as ``filenames``.


   .. py:method:: get_tag_batch_wrapper(self, tag, filenames, params=None)


   .. py:method:: get_tag_wrapper(self, tag, filename, params=None)


   .. py:method:: get_tags_batch_wrapper(self, tags, filenames, params=None)


   .. py:method:: get_tags_wrapper(self, tags, filename, params=None)


   .. py:method:: set_keywords(self, filename, mode, keywords)

      Modifies the keywords tag for the given file.

      This is a convenience function derived from `set_keywords_batch()`.
      Only difference is that it takes as last argument only one file name
      as a string.


   .. py:method:: set_keywords_batch(self, filenames, mode, keywords)

      Modifies the keywords tag for the given files.

      The first argument is the operation mode:

      * KW_REPLACE: Replace (i.e. set) the full keywords tag with `keywords`.
      * KW_ADD:     Add `keywords` to the keywords tag.
                              If a keyword is present, just keep it.
      * KW_REMOVE:  Remove `keywords` from the keywords tag.
                              If a keyword wasn't present, just leave it.

      The second argument is an iterable of key words.

      The third argument is an iterable of file names.

      The format of the return value is the same as for
      :py:meth:`execute()`.

      It can be passed into `check_ok()` and `format_error()`.


   .. py:method:: set_tags(self, filename, tags)

      Writes the values of the specified tags for the given file.

      This is a convenience function derived from `set_tags_batch()`.
      Only difference is that it takes as last arugemnt only one file name
      as a string.


   .. py:method:: set_tags_batch(self, filenames, tags)

      Writes the values of the specified tags for the given files.

      The first argument is a dictionary of tags and values.  The tag names may
      include group names, as usual in the format <group>:<tag>.

      The second argument is an iterable of file names.

      The format of the return value is the same as for
      :py:meth:`execute()`.

      It can be passed into `check_ok()` and `format_error()`.

      tags items can be lists, in which case, the tag will be passed
      with each item in the list, in the order given



.. py:class:: ExifToolHelper(auto_start=True, **kwargs)

   Bases: :py:obj:`exiftool.exiftool.ExifTool`

   This class extends the low-level :py:class:`exiftool.ExifTool` class with 'wrapper'/'helper' functionality

   It keeps low-level core functionality with the base class but extends helper functions in a separate class

   .. py:method:: execute(self, *params)

      override the execute() method

      Adds logic to auto-start if not running, if auto_start == True


   .. py:method:: get_metadata(self, files, params=None)

      Return all meta-data for the given files.

      Files parameter matches :py:meth:`get_tags()`

      wildcard strings are accepted as it's passed straight to exiftool

      The return value will have the format described in the
      documentation of :py:meth:`get_tags()`.


   .. py:method:: get_tags(self, files, tags, params=None)

      Return only specified tags for the given files.

      The first argument is the files to be worked on.  It can be:

      * an iterable of strings/bytes
      * string/bytes

      The list is copied and any non-basestring elements are converted to str (to support PurePath and other similar objects)

      Filenames are NOT checked for existence, that is left up to the caller.
      It is passed directly to exiftool, which supports wildcards, etc.  Please refer to the exiftool documentation


      The second argument is an iterable of tags.  The tag names may
      include group names, as usual in the format <group>:<tag>.

      If tags is None, or [], then returns all tags


      The format of the return value is the same as for
      :py:meth:`exiftool.ExifTool.execute_json()`.


   .. py:method:: run(self)

      override the run() method

      Adds logic to check if already running.  Will not attempt to run if already running (so no warning about 'ExifTool already running' will trigger) 


   .. py:method:: terminate(self, **opts)

      override the terminate() method

      Adds logic to check if not running (so no warning about 'ExifTool not running' will trigger)

      opts are passed directly to the parent verbatim



